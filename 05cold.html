<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>姓名搜尋</title>
</head>
<body>
    <h1>🎯 夏凱納之最 👍</h1>
    <h2>請選擇說話最冷的同工</h2>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="輸入姓名...">
    </div>
    <ul id="resultList"></ul>
    <div id="bottomBar">
        <div class="message" id="message">請點選同工姓名</div>
        <button style="display: none;" id="submitBtn">送出</button>
    </div>

    <script src="names.js"></script>
    <script>
        const searchInput = document.getElementById("searchInput");
        const resultList = document.getElementById("resultList");
        const message = document.getElementById("message");
        const submitBtn = document.getElementById("submitBtn");

        let selectedName = null;

        function renderList(list) {
            resultList.innerHTML = "";
            list.forEach(name => {
                const li = document.createElement("li");
                li.textContent = name;
                li.onclick = () => {
                    selectedName = name;
                    [...resultList.children].forEach(item => item.classList.remove("selected"));
                    li.classList.add("selected");
                    message.textContent = `已選：${name}`;
                    submitBtn.style.display = "block";
                };
                resultList.appendChild(li);
            });
        }

        renderList(names);

        searchInput.addEventListener("input", function () {
            const query = this.value.trim();
            resultList.innerHTML = "";
            message.textContent = "";
            submitBtn.style.display = "none"; // 清空時隱藏按鈕

            if (query === "") return;

            const results = names.filter(name => name.includes(query));
            results.forEach(name => {
                const li = document.createElement("li");
                li.textContent = name;

                li.onclick = () => {
                    selectedName = name;
                    [...resultList.children].forEach(item => item.classList.remove("selected"));
                    li.classList.add("selected");
                    message.textContent = `已選：${name}`;
                    submitBtn.style.display = "block"; // 有選人時才出現
                };

                resultList.appendChild(li);
            });
        });

        submitBtn.addEventListener("click", () => {
            if (!selectedName) return;

            const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSeqy7ut67yNiLqXNuyiMWsGDKkj6qJmKAAHl2oDo1IQwO1VFA/formResponse";
            const entryId = "entry.1519043905";

            fetch(formUrl, {
                method: "POST",
                body: new URLSearchParams({
                    [entryId]: selectedName
                }),
                mode: "no-cors"
            }).then(() => {
                window.location.href = "05wait.html";
            }).catch(() => {
                alert("送出失敗，請再試一次！");
            });
        });
    </script>
</body>
</html>
